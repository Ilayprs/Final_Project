<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gaming Stuff Online Store</title>
    <link rel="stylesheet" href="Cus_Store.css">
</head>
<body>
    <header>
        <h1>Gaming Stuff Online Store</h1>
        <nav>
            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#products">Products</a></li>
            </ul>
        </nav>
        <div class="icons-container">
            <div class="icon cart-icon" onclick="openCartModal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-cart" viewBox="0 0 16 16">
                    <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5M3.102 4l1.313 7h8.17l1.313-7zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4m7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
                </svg>
            </div>
            <div class="icon personal-icon" onclick="openPersonalArea()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM8 9a6 6 0 0 0-6 6v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-1a6 6 0 0 0-6-6z"/>
                </svg>
            </div>
        </div>
    </header>
    
    
    
    <div class="background">
        <section id="home">
            <h2>Welcome</h2>
            <p>Welcome to the Gaming Stuff Online Store. Explore our range of products and add them to your shopping cart.</p>
        </section>

<!-- Video Section 
<div class="video-section">
    <canvas id="videoCanvas"></canvas>
    <div class="iframe-container">
        <iframe width="378" height="672" src="https://www.youtube.com/embed/b-GYW-gHb7g" title="Mouse Montage (my new main)" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
    </div>
</div>
-->

<!-- Filters Section -->
<div class="filters">
    <h2>Filter Products</h2>
<!-- Filter Form -->
<div class="filter-group">
    <label for="filterCompany">Company:</label>
    <div id="filterCompanyContainer"></div>
</div>

    <!-- Filter by Price -->
    <div class="filter-group">
        <label for="minPrice">Min Price:</label>
        <input type="number" id="minPrice" name="minPrice" class="filter-input" placeholder="0" step="0.01">
        <label for="maxPrice">Max Price:</label>
        <input type="number" id="maxPrice" name="maxPrice" class="filter-input" placeholder="1000" step="0.01">
    </div>

    <!-- Filter by Category -->
    <div class="filter-group">
    <label>Category:</label>
    <div id="filterCategoryContainer"></div>
    </div>

    <!-- Filter by RGB -->
    <div class="filter-group">
        <label for="rgbCheckbox" class="filter-checkbox">
            <input type="checkbox" id="rgbCheckbox" name="rgb">
            RGB
        </label>
    </div>

    <!-- Filter by Wireless -->
    <div class="filter-group">
        <label for="wirelessCheckbox" class="filter-checkbox">
            <input type="checkbox" id="wirelessCheckbox" name="wireless">
            Wireless
        </label>
    </div>

    <button type="button" class="filter-button" onclick="applyFilters()">Apply Filters</button>
    <button type="button" class="filter-button" onclick="window.location.reload()">Reset Filters</button>
</form>
</div>

        
        

        
        <section id="products">
            <h2>Products</h2>
            <div class="category-list">
                <!-- Categories will be dynamically populated here -->
            </div>
            <div class="product-list">
                <!-- Products will be dynamically populated here -->
            </div>
        </section>
    

        <!-- Modal for Shopping Cart -->
        <div id="cartModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeCartModal()">&times;</span>
                <h2>Shopping Cart</h2>
                <div class="cart-list">
                    <!-- Shopping cart items will be displayed here -->
                </div>
                <button id="checkoutBtn" onclick="openCheckoutModal()" class="proceed">Proceed to Checkout</button>
            </div>
        </div>

        <!-- Modal for Checkout Confirmation -->
        <div id="checkoutModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" onclick="closeCheckoutModal()">&times;</span>
                <h2 class="modal-title">Checkout</h2>
                <p class="modal-text">Total Amount: <span id="totalAmount">$0.00</span></p>
                <p class="modal-text">Are you sure you want to proceed with the purchase?</p>
                <button class="modal-btn confirm-btn" onclick="confirmCheckout()">Confirm Checkout</button>
                <p class="modal-text">Add money to your account:</p>
                <input type="number" id="addMoney" placeholder="Enter amount" class="modal-input">
                <button class="modal-btn add-money-btn" onclick="addMoney()">Add Money</button>
                <button class="modal-btn cancel-btn" onclick="closeCheckoutModal()">Cancel</button>
            </div>
        </div>



        <div id="personalAreaModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closePersonalArea()">&times;</span>
                <h2>Personal Area</h2>
                <div class="profile-info">
                    <p id="personalUserName"></p>
                    <p id="personalUserId"></p>
                    <p id="personalUserType"></p>
                    <p id = 'custCredit'></p>
                    <p>Company: Gaming Supplies Inc.</p>
                    <button onclick="editProfile()" class="buttonedit">Edit Profile</button>
                </div>
                <div id="customerOrders">
                    <h3>My Orders</h3>
                    <div id="customerOrdersList">
                        <!-- Orders will be dynamically populated here -->
                    </div>
                </div>
            </div>
        </div>
        
        

    <!-- Modal for Editing Profile -->
<div id="editProfileModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="closeEditProfileModal()">&times;</span>
        <h2>Edit Profile</h2>
        <form id="editProfileForm">
            <label for="newUsername">New Username:</label>
            <input type="text" id="newUsername" name="newUsername" required>
            
            <label for="newPassword">New Password:</label>
            <input type="password" id="newPassword" name="newPassword" required>
            
            <label for="newCity">New City:</label>
            <input type="text" id="newCity" name="newCity" required>
            
            <button type="submit" class="buttonedit" style="    background: linear-gradient(135deg, #159728, #7ede89); /* Gradient background */">Save Changes</button>
        </form>
    </div>
</div>
<h1>Popular Games from Twitch</h1>
    <button class="toggle-button" onclick="toggleGameList()">Show Games</button>
    <div id="game-list" class="game-list" style="display: none;">
        <!-- Games will be displayed here -->
    </div>
    <div id="error-message" class="error"></div>
    
    <script src="Cus_store.js"></script>
    <script>
        let items = []; // This will hold the items fetched from MongoDB

        // Fetch items from MongoDB and populate filters
        async function fetchItems() {
            try {
                const response = await fetch('/api/items');
                if (response.ok) {
                    items = await response.json();
                    populateFilters();
                } else {
                    console.error('Failed to fetch items');
                }
            } catch (error) {
                console.error('Error fetching items:', error);
            }
        }

        // Populate filter options dynamically
// Populate company checkboxes dynamically
// Populate category checkboxes dynamically
function populateFilters() {
    const companyContainer = document.getElementById('filterCompanyContainer');
    const categoryContainer = document.getElementById('filterCategoryContainer');

    // Extract unique values for company and category
    const companies = [...new Set(items.map(item => item.companyName))];
    const categories = [...new Set(items.map(item => item.category))];

    // Populate company checkboxes
    companyContainer.innerHTML = '';
    companies.forEach(company => {
        companyContainer.innerHTML += `
            <label>
                <input type="checkbox" class="company-checkbox" value="${company}">
                ${company}
            </label>
        `;
    });

    // Populate category checkboxes
    categoryContainer.innerHTML = '';
    categories.forEach(category => {
        categoryContainer.innerHTML += `
            <label>
                <input type="checkbox" class="category-checkbox" value="${category}">
                ${category}
            </label>
        `;
    });
}



        // Apply filters and display results
// Apply filters and display results
// Apply filters and display results
async function applyFilters() {
    const minPrice = parseFloat(document.getElementById('minPrice').value) || 0;
    const maxPrice = parseFloat(document.getElementById('maxPrice').value) || 10000;
    const rgb = document.getElementById('rgbCheckbox').checked;
    const wireless = document.getElementById('wirelessCheckbox').checked;

    // Get selected companies
    const selectedCompanies = Array.from(document.querySelectorAll('.company-checkbox:checked'))
        .map(checkbox => checkbox.value.toLowerCase());

    // Get selected categories
    const selectedCategories = Array.from(document.querySelectorAll('.category-checkbox:checked'))
        .map(checkbox => checkbox.value.toLowerCase());

    try {
        const response = await fetch(`/api/items?minPrice=${minPrice}&maxPrice=${maxPrice}&rgb=${rgb}&wireless=${wireless}`);
        if (response.ok) {
            let items = await response.json();
            
            // Filter items by selected companies
            if (selectedCompanies.length > 0) {
                items = items.filter(item => selectedCompanies.includes(item.companyName.toLowerCase()));
            }

            // Filter items by selected categories
            if (selectedCategories.length > 0) {
                items = items.filter(item => selectedCategories.includes(item.category.toLowerCase()));
            }

            displayItems(items);
        } else {
            console.error('Failed to fetch filtered items');
        }
    } catch (error) {
        console.error('Error fetching filtered items:', error);
    }
}

// Display items in the products section
function displayItems(items) {
    const categoryList = document.querySelector('.category-list');
    categoryList.innerHTML = '';
    const productsDiv = document.querySelector('.product-list');
    productsDiv.innerHTML = ''; // Clear previous items

    items.forEach(item => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'product';
        itemDiv.innerHTML = `
            <h3>${item.name}</h3>
            <p>Price: $${item.price.toFixed(2)}</p>
            <p>Category: ${item.category}</p>
            <p>Company: ${item.companyName}</p>
            <p>RGB: ${item.rgb ? 'Yes' : 'No'}</p>
            <p>Wireless: ${item.wireless ? 'Yes' : 'No'}</p>
            <button onclick="addToCart('${item._id}')" class="filter-button">Add to Cart</button>
        `;
        productsDiv.appendChild(itemDiv);
    });
}

// Fetch items on page load
fetchItems();

let isGameListVisible = false;
let gameDataCache = [];

async function fetchGames() {
    const clientId = 'dq1puf0pbndxn4qjpcux99ha73u34k';
    const clientSecret = '8mqt0eyg2kgaiuxzqhkwudjmamssug';

    try {
        // Step 1: Get OAuth Token
        const authResponse = await fetch('https://id.twitch.tv/oauth2/token', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: new URLSearchParams({
                'client_id': clientId,
                'client_secret': clientSecret,
                'grant_type': 'client_credentials'
            })
        });

        if (!authResponse.ok) {
            throw new Error(`Authentication failed: ${authResponse.statusText}`);
        }

        const authData = await authResponse.json();
        const accessToken = authData.access_token;

        // Step 2: Fetch Popular Games
        const gameResponse = await fetch('https://api.twitch.tv/helix/games/top', {
            headers: {
                'Client-ID': clientId,
                'Authorization': `Bearer ${accessToken}`
            }
        });

        if (!gameResponse.ok) {
            throw new Error(`Failed to fetch games data: ${gameResponse.statusText}`);
        }

        const gameData = await gameResponse.json();
        gameDataCache = gameData.data; // Cache the game data
        displayGames(gameDataCache);
    } catch (error) {
        console.error('Error:', error);
        document.getElementById('error-message').innerText = `Error: ${error.message}`;
    }
}

function displayGames(games) {
    const list = document.getElementById('game-list');
    list.innerHTML = '';

    if (games.length === 0) {
        list.innerHTML = 'No games found.';
        return;
    }

    games.forEach(game => {
        const gameItem = document.createElement('div');
        gameItem.className = 'game-item';
        gameItem.innerHTML = `
            <img src="${game.box_art_url.replace('{width}', '200').replace('{height}', '300')}" alt="${game.name}">
            <div>
                <h3>${game.name}</h3>
                <p>Viewers: ${game.viewers}</p>
            </div>
        `;
        list.appendChild(gameItem);
    });
}

function toggleGameList() {
    const list = document.getElementById('game-list');
    const button = document.querySelector('.toggle-button');
    
    if (isGameListVisible) {
        list.style.display = 'none';
        button.innerText = 'Show Games';
    } else {
        list.style.display = 'block';
        button.innerText = 'Hide Games';
    }

    if (!gameDataCache.length) {
        fetchGames();
    } else {
        displayGames(gameDataCache);
    }

    isGameListVisible = !isGameListVisible;
}

// Fetch games initially
fetchGames();

// Set up an interval to update every 10 minutes (600,000 milliseconds)
setInterval(fetchGames, 600000);
    </script>
</div>
</body>
</html>
